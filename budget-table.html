<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Budgeting Table</title>
    <link rel="icon" type="image/png" href="Images/favicon_1.png">
    <link rel="stylesheet" href="Styles/BudgetTable.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="main-container">
        <div id="income-box">
            <h2>Enter Income</h2>
            <input type="number" step="0.01" id="income" placeholder="Income" required>
        </div>

        <div id="month-box">
            <h2>Select Month</h2>
            <select id="month">
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>
        </div>

        <form id="add-row-form">
            <h2>Add a New Bill</h2>
            <input type="text" id="bill-name" placeholder="Bill Name" required>
            <input type="number" step="0.01" id="bill-cost" placeholder="Cost" required>
            <select id="bill-due-date" required>
                <option value="" disabled selected>Select Due Date</option>
            </select>
            <button type="submit">Add Row</button>
        </form>

        <div id="pie-chart-container">
            <canvas id="income-pie-chart"></canvas>
        </div>

        Delete if breaks
        <div id="bar-chart-container">
            <canvas id="monthly-bar-chart"></canvas>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Bill Name</th>
                <th>Cost</th>
                <th>Due Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script>
        const billDueDateSelect = document.getElementById('bill-due-date');
        for (let i = 1; i <= 31; i++) {
            const option = document.createElement('option');
            option.value = i;
            option.textContent = i;
            billDueDateSelect.appendChild(option);
        }

        const incomeInput = document.getElementById("income");
        const tableBody = document.getElementById("table-body");
        const monthSelect = document.getElementById("month");

        let monthlyData = {
            "January": { income: 0, totalBills: 0, bills: [] },
            "February": { income: 0, totalBills: 0, bills: [] },
            "March": { income: 0, totalBills: 0, bills: [] },
            "April": { income: 0, totalBills: 0, bills: [] },
            "May": { income: 0, totalBills: 0, bills: [] },
            "June": { income: 0, totalBills: 0, bills: [] },
            "July": { income: 0, totalBills: 0, bills: [] },
            "August": { income: 0, totalBills: 0, bills: [] },
            "September": { income: 0, totalBills: 0, bills: [] },
            "October": { income: 0, totalBills: 0, bills: [] },
            "November": { income: 0, totalBills: 0, bills: [] },
            "December": { income: 0, totalBills: 0, bills: [] },
        };

        let currentMonth = monthSelect.value;
        let incomePieChart, monlyBarChart;

        document.getElementById("add-row-form").addEventListener("submit", function (event) {
            event.preventDefault();
            const billName = document.getElementById("bill-name").value;
            const billCost = parseFloat(document.getElementById("bill-cost").value);
            const billDueDate = billDueDateSelect.value;

            if (billName && billCost && billDueDate) {
                const bill = { name: billName, cost: billCost, dueDate: billDueDate };
                monthlyData[currentMonth].bills.push(bill);
                monthlyData[currentMonth].totalBills += billCost;

                updateTableAndChart(monthlyData[currentMonth]);
                document.getElementById("add-row-form").reset();
            }
        });

        incomeInput.addEventListener("input", function () {
            monthlyData[currentMonth].income = parseFloat(this.value) || 0;
            updatePieChart(monthlyData[currentMonth]);
        });

        monthSelect.addEventListener("change", function () {
            currentMonth = this.value;
            updateTableAndChart(monthlyData[currentMonth]);
            incomeInput.value = monthlyData[currentMonth].income;
        });

        function updateTableAndChart(data) {
            tableBody.innerHTML = "";
            data.bills.forEach((bill, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${bill.name}</td>
                    <td>$${bill.cost.toFixed(2)}</td>
                    <td>${bill.dueDate}</td>
                    <td><button class="delete-btn" data-index="${index}">Delete</button></td>
                `;
                row.querySelector(".delete-btn").addEventListener("click", function () {
                    const idx = this.getAttribute("data-index");
                    monthlyData[currentMonth].totalBills -= data.bills[idx].cost;
                    data.bills.splice(idx, 1);
                    updateTableAndChart(data);
                });
                tableBody.appendChild(row);
            });
            updatePieChart(data);
        }

        function updatePieChart(data) {
            const ctx = document.getElementById('income-pie-chart').getContext('2d');
            if (incomePieChart) incomePieChart.destroy();

            incomePieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Income', 'Bills'],
                    datasets: [{
                        data: [data.income, data.totalBills],
                        backgroundColor: ['#36A2EB', '#FF5733'],
                        hoverBackgroundColor: ['#36A2EB', '#FF5733']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return tooltipItem.label + ': $' + tooltipItem.raw;
                                }
                            }
                        }
                    }
                }
            });
        }

        //Delete if breaks
        function updateBarChart() {
            const ctx = document.getElementById('monthly-bar-chart').getContext('2d');
            if (monthlyBarChart) monthlyBarChart.destroy();

            const labels = Object.keys(monthlyData);
            const incomeData = labels.map(month => monthlyData[month].income);
            const billsData = labels.map(month => monthlyData[month].totalBills);

            monthlyBarChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Income',
                            data: incomeData,
                            backgroundColor: '#36A2EB'
                        },
                        {
                            label: 'Bills',
                            data: billsData,
                            backgroundColor: '#FF5733'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { position: 'top' }
                    },
                    scales: {
                        x: { title: { display: true, text: 'Months' } },
                        y: { title: { display: true, text: 'Amount ($)' } }
                    }
                }
            });
        }

        // Initialize table and chart
        updateTableAndChart(monthlyData[currentMonth]);
    </script>
</body>
</html>
