<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Budgeting Table</title>
    <link rel="icon" type="image/png" href="Images/favicon_1.png">
    <link rel="stylesheet" href="Styles/BudgetTable.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="main-container">
        <!-- Income container -->
        <div id="income-box">
            <h2>Enter Income</h2>
            <input type="number" step="0.01" id="income" placeholder="Income" required>
        </div>

        <!-- Add bill container (Form) -->
        <form id="add-row-form">
            <h2>Add a New Bill</h2>
            <input type="text" id="bill-name" placeholder="Bill Name" required>
            <input type="number" step="0.01" id="bill-cost" placeholder="Cost" required>
            <select id="bill-due-date" required>
                <option value="" disabled selected>Select Due Date</option>
                <script>
                    const selectElement = document.getElementById('bill-due-date');
                    for (let i = 1; i <= 31; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = i;
                        selectElement.appendChild(option);
                    }
                </script>
            </select>
            <button type="submit">Add Row</button>
        </form>

        <!-- Pie chart container -->
        <div id="pie-chart-container">
            <canvas id="income-pie-chart"></canvas>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Bill Name</th>
                <th>Cost</th>
                <th>Due Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="table-body"></tbody>
    </table>

    <script type="text/javascript" src="/JavaScript/BudgetTable.js"></script>
    <script type="text/javascript">
        let totalIncome = 0;
        let totalBills = 0;

        document.getElementById("add-row-form").addEventListener("submit", function (event) {
            event.preventDefault();
            const billName = document.getElementById("bill-name").value;
            const billCost = parseFloat(document.getElementById("bill-cost").value);
            const billDueDate = document.getElementById("bill-due-date").value;

            if (billName && billCost && billDueDate) {
                const tableBody = document.getElementById("table-body");
                const newRow = document.createElement("tr");
                newRow.innerHTML = ` 
                    <td>${billName}</td>
                    <td>$${billCost.toFixed(2)}</td>
                    <td>${billDueDate}</td>
                    <td><button class="action-button delete-btn">Delete</button></td>
                `;
                newRow.querySelector(".delete-btn").addEventListener("click", function () {
                    newRow.remove();
                    updateBillData();
                });
                tableBody.appendChild(newRow);
                totalBills += billCost;
                updatePieChart();
                document.getElementById("add-row-form").reset();
            }
        });

        function updateBillData() {
            const rows = document.querySelectorAll("#table-body tr");
            totalBills = 0;
            rows.forEach(row => {
                const costCell = row.cells[1];
                const cost = parseFloat(costCell.textContent.replace('$', ''));
                totalBills += cost;
            });
            updatePieChart();
        }

        function updatePieChart() {
            const ctx = document.getElementById('income-pie-chart').getContext('2d');
            if (incomePieChart) {
                incomePieChart.destroy();
            }
            incomePieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Income', 'Bills'],
                    datasets: [{
                        data: [totalIncome, totalBills],
                        backgroundColor: ['#36A2EB', '#FF5733'],
                        hoverBackgroundColor: ['#36A2EB', '#FF5733']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return tooltipItem.label + ': $' + tooltipItem.raw;
                                }
                            }
                        }
                    }
                }
            });
        }

        document.getElementById("income").addEventListener("input", function() {
            totalIncome = parseFloat(document.getElementById("income").value) || 0;
            updatePieChart();
        });

        let incomePieChart = new Chart(document.getElementById('income-pie-chart').getContext('2d'), {
            type: 'pie',
            data: {
                labels: ['Income', 'Bills'],
                datasets: [{
                    data: [0, 0],
                    backgroundColor: ['#36A2EB', '#FF5733'],
                    hoverBackgroundColor: ['#36A2EB', '#FF5733']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        callbacks: {
                            label: function(tooltipItem) {
                                return tooltipItem.label + ': $' + tooltipItem.raw;
                            }
                        }
                    }
                }
            }
        });
    </script>
</body>
</html>
